<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>My Kawaii To-Do ‚ú®</title>
    <style>
        body {
            background: linear-gradient(135deg, #fbc2eb 0%, #a6c1ee 100%);
            font-family: 'Comic Sans MS', cursive, sans-serif;
            display: flex;
            justify-content: center;
            padding: 40px;
            color: #5d4037;
        }
        .container {
            background: rgba(255, 255, 255, 0.9);
            padding: 30px;
            border-radius: 30px;
            box-shadow: 0 10px 30px rgba(255, 105, 180, 0.3);
            width: 500px;
            border: 4px solid #f8bbd0;
        }
        h2 { text-align: center; color: #ec407a; font-size: 2em; text-shadow: 1px 1px 2px #fff; }
        input {
            width: calc(100% - 28px);
            padding: 12px;
            margin: 8px 0;
            border-radius: 20px;
            border: 2px solid #f48fb1;
            background: #fffafa;
            outline: none;
        }
        .main-btn {
            width: 100%;
            padding: 15px;
            background: #f06292;
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.1em;
            box-shadow: 0 4px #ad1457;
            transition: 0.2s;
            margin-bottom: 20px;
        }
        .main-btn:hover { background: #f48fb1; transform: translateY(-2px); }
        
        .task-card {
            background: white;
            margin-top: 15px;
            padding: 15px;
            border-radius: 20px;
            border: 2px dashed #ce93d8;
            display: flex;
            flex-direction: column;
            animation: fadeIn 0.5s;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .task-info.done { text-decoration: line-through; color: #b0bec5; }
        .task-status { font-size: 0.8em; color: #f06292; font-weight: bold; }
        
        .actions {
            display: flex;
            justify-content: flex-end;
            gap: 8px;
            margin-top: 10px;
        }
        .btn-small { 
            padding: 6px 12px; 
            font-size: 13px; 
            border: none; 
            color: white; 
            border-radius: 12px; 
            cursor: pointer;
            transition: 0.2s;
        }
        .btn-delete { background: #ef5350; box-shadow: 0 2px #c62828; }
        .btn-status { background: #66bb6a; box-shadow: 0 2px #2e7d32; }
        .btn-small:hover { opacity: 0.8; transform: scale(1.05); }
    </style>
</head>
<body>
    <div class="container">
        <h2>Tasks List üéÄ</h2>
        <input type="text" id="title" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ö—É–ø–∏—Ç—å –º–æ–ª–æ–∫–æ)...">
        <input type="text" id="desc" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ 3.2% –∂–∏—Ä–Ω–æ—Å—Ç–∏)...">
        <button class="main-btn" onclick="addTask()">–î–æ–±–∞–≤–∏—Ç—å –∫–æ—Ç–∏–∫–∞ üêæ</button>
        <div id="taskList"></div>
    </div>

    <script>
        const API = "/tasks";

        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∑–∞–¥–∞—á (GET)
        async function loadTasks() {
            try {
                const res = await fetch(API);
                if (!res.ok) throw new Error("–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞");
                const data = await res.json();
                
                const list = document.getElementById('taskList');
                list.innerHTML = '';
                
                data.forEach(t => {
                    const isDone = t.status === 'done';
                    list.innerHTML += `
                        <div class="task-card">
                            <div class="task-info ${isDone ? 'done' : ''}">
                                <span class="task-status">[${t.status}]</span><br>
                                <b>${t.title}</b><br>
                                <small>${t.description || '–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è'}</small>
                            </div>
                            <div class="actions">
                                <button class="btn-small btn-status" onclick="toggleStatus(${t.id}, '${t.status}')">
                                    ${isDone ? 'üêæ –í–µ—Ä–Ω—É—Ç—å' : '‚ú® –ì–æ—Ç–æ–≤–æ'}
                                </button>
                                <button class="btn-small btn-delete" onclick="deleteTask(${t.id})">üå∏ –£–¥–∞–ª–∏—Ç—å</button>
                            </div>
                        </div>`;
                });
            } catch (e) { console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ:", e); }
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ (POST)
        async function addTask() {
            const titleInput = document.getElementById('title');
            const descInput = document.getElementById('desc');
            
            if(!titleInput.value) return alert("–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ!");

            await fetch(API, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ 
                    title: titleInput.value, 
                    description: descInput.value, 
                    status: "todo" 
                })
            });
            titleInput.value = '';
            descInput.value = '';
            loadTasks();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ (PATCH)
        async function toggleStatus(id, currentStatus) {
            const newStatus = currentStatus === 'done' ? 'todo' : 'done';
            await fetch(`${API}/${id}`, {
                method: 'PATCH',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ status: newStatus })
            });
            loadTasks();
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ (DELETE)
        async function deleteTask(id) {
            if(!confirm("–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –ª–∞–ø–∫—É?")) return;
            await fetch(`${API}/${id}`, { method: 'DELETE' });
            loadTasks();
        }

        // –ü–µ—Ä–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
        loadTasks();
    </script>
</body>
</html>
